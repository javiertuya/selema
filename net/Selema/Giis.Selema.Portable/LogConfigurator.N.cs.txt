using System;
using NLog;

namespace Giis.Selema.Portable
{
    /// <summary>
    /// Configuracion de logs de las sesiones web para SeleManager
    /// </summary>
    public class LogConfigurator
    {
        public void Configure(string loggerName, string logName)
        {
            try
            {
                //var config = new NLog.Config.LoggingConfiguration();
                var config = LogManager.Configuration;

                //Crea logs a consola y fichero
                //utiliza un layout como la version java con log4j, mas legible que
                // ${date:format=HH\:mm\:ss}|${level:uppercase=true}|${logger}|${message}"
                //el layout contiene br pues el fichero sera html para poder ver links a videos e imagenes
                var logfile = new NLog.Targets.FileTarget()
                {
                    FileName = logName,
                    Layout = @"<br/><span style=""font-family:monospace;"">[${level:uppercase=true}] ${date:format=HH\:mm\:ss} ${logger} - ${message}</span>"
                };
                //var logconsole = new NLog.Targets.ConsoleTarget();
                //config.AddRule(LogLevel.Info, LogLevel.Fatal, logconsole, loggerName);
                config.AddRule(LogLevel.Info, LogLevel.Fatal, logfile, loggerName);
                //config.AddTarget(loggerName, logconsole);
                //config.AddTarget(loggerName, logfile);
                LogManager.Configuration = config;

                Logger thisLogger = LogManager.GetLogger(loggerName);
                thisLogger.Info("SeleManager logger created, writing to file " + logName);
            }
            catch (Exception e)
            {
                throw new SelemaException("Can't configure logging", e);
            }
        }
    }
}
